---
kind: pipeline
name: ci-s390x

platform:
  os: linux
  arch: amd64

node:
  arch: s390x

steps:
- name: ci
  #failure: ignore
  image: rancher/dapper:v0.5.7
  purge: true
  commands:
  - dapper ci
  environment:
    REGISTRY: luistt
    DOCKER_PASS:
      from_secret: docker_password
    DOCKER_USER:
      from_secret: docker_username
  volumes:
  - name: docker
    path: /var/run/docker.sock
  #when:
    #event:
    #- tag
  instance:
    - drone.suse.dev

#- name: validate
  #image: rancher/dapper:v0.5.7
  #commands:
  #- dapper validate
  #volumes:
  #- name: docker
    #path: /var/run/docker.sock
  #when:
    #event:
    #- push
    #- pull_request
    #instance:
    #- drone-pr.rancher.io

#- name: build
  #image: rancher/dapper:v0.5.7
  #commands:
  #- dapper build
  #volumes:
  #- name: docker
    #path: /var/run/docker.sock
  #when:
    #event:
    #- push
    #- pull_request
    #instance:
    #- drone-pr.rancher.io

#- name: test
  #image: rancher/dapper:v0.5.7
  #commands:
  #- dapper test
  #volumes:
  #- name: docker
    #path: /var/run/docker.sock
  #when:
    #event:
    #- push
    #- pull_request
    #instance:
    #- drone-pr.rancher.io

volumes:
- name: docker
  host:
    path: /var/run/docker.sock
